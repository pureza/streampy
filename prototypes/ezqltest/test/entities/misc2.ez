temp_readings = stream (:room_id, :temperature);;

lastTemp = temp_readings.last(:temperature);;

define fact(n:int) : int =
  if n == 0
    then 1
    else n + fact (n - 1);;


// Non-recursive function with global deps
define x2a(n:int) : int = n;;


when (temp_readings, fun ev -> print ((if lastTemp > 30 then fact else x2a) (ev.temperature)));;


#! temp_readings
Timestamp, room_id, temperature
2,               1,      25
4,               3,      45  # Out-of-order keys (1, 3, 2 instead of 1, 2, 3)
5,               1,      25  # Retain the previous value
6,               2,      50
7,               3,      30
9,               1,      23