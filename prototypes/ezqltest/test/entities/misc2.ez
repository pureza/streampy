seg_speed_str = stream (:vehicle_id, :speed, :segment_id);;

define justNow(x:bool) : bool = x[1 sec][0];;

entity Segment =
   createFrom(seg_speed_str, :segment_id)
   hasMany :vehicles

   member self.blah = self.speed[5 min].avg();;


entity Vehicle =
  createFrom(seg_speed_str, :vehicle_id)
  belongsTo :segment;;


blah = seg_speed_str.last(:segment_id) > 1;;

previous = blah.updates().prev(:value);;

when (previous.updates(), fun _ -> print (previous); print (justNow(blah)));;



#! seg_speed_str
timestamp, vehicle_id, speed, segment_id
1,                 10,    70,          1
2,                 20,    80,          1
3,                 10,    90,          2
4,                 30,    71,          1
5,                 20,    81,          2
6,                 30,    91,          2
7,                 10,    72,          3
8,                 20,    82,          3





